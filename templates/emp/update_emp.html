<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Update Or Delete Employee</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

    <script>
        function validateForm() {
            // Phone validation
            const phone = document.getElementById("phone").value;
            if (!/^\d{10}$/.test(phone)) {
                alert("Phone number must be 10 digits");
                return false;
            }

            // Email validation
            const email = document.getElementById("email").value;
            if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                alert("Please enter a valid email address");
                return false;
            }
            return true;
        }
    </script>
</head>

<body style="background-color: black;" class="text-white">
    {% include 'emp/navbar.html' %}

    <h1 class="text-center my-3">Update Or Delete Employee Details</h1>

    <div class="container">
        <div class="row">
            <div class="col-md-6 offset-md-3">
                <div class="card bg-secondary text-white">
                    <div class="card-body">
                        <form onsubmit="return validateForm()" action="{% url 'update_emp' %}" method="POST">
                            {% csrf_token %}

                            <!-- Employee ID -->
                            <div class="mb-3">
                                <label class="form-label">Employee Code</label>
                                <input type="text" class="form-control" id="emp_code" name="emp_code"
                                    value="{{ emp.emp_code }}" readonly />
                            </div>

                            <!-- First Name -->
                            <div class="mb-3">
                                <label class="form-label">Employee First Name</label>
                                <input type="text" class="form-control" id="fname" name="f_name"
                                    value="{{ emp.f_name }}" readonly />
                            </div>

                            <!-- Last Name -->
                            <div class="mb-3">
                                <label class="form-label">Employee Last Name</label>
                                <input type="text" class="form-control" id="lname" name="l_name"
                                    value="{{ emp.l_name }}" readonly />
                            </div>

                            <!-- Gender -->
                            <div class="mb-3">
                                <label class="form-label d-block">Gender</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" value="Male" 
                                    {% if emp.gender == 'Male' %}checked{% endif %} disabled />
                                    <label class="form-check-label">Male</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" value="Female" 
                                    {% if emp.gender == 'Female' %}checked{% endif %} disabled />
                                    <label class="form-check-label">Female</label>
                                </div>
                            </div>

                            <!-- Phone -->
                            <div class="mb-3">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="phone" name="phone" value="{{ emp.phone }}"
                                    required />
                            </div>

                            <!-- Email -->
                            <div class="mb-3">
                                <label class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="email" name="email" value="{{ emp.email }}"
                                    required />
                            </div>

                            <!-- Address -->
                            <div class="mb-3">
                                <label class="form-label">Address</label>
                                <textarea class="form-control" id="address" name="address" rows="3"
                                    required>{{ emp.address }}</textarea>
                            </div>

                            <!-- Department -->
                            <div class="mb-3">
                                <label for="department" class="form-label">Department</label>
                                <select class="form-select" id="department" name="department" required>
                                    <option value="" disabled>Select Department</option>
                                    <option value="Human Resources" 
                                     {% if emp.department == "Human Resources" %}selected{% endif %}>Human Resources</option>
                                    <option value="Information Technology" 
                                    {% if emp.department == "Information Technology" %}selected{% endif %}>Information Technology</option>
                                    <option value="Design and Creative" 
                                    {% if emp.department == "Design and Creative" %}selected{% endif %}>Design and Creative</option>
                                    <option value="Interns" 
                                    {% if emp.department == "Interns" %}selected{% endif %}>Interns</option>
                                    <option value="Administration" 
                                    {% if emp.department == "Administration" %}selected{% endif %}>Administration</option>
                                    <option value="Customer Support" 
                                    {% if emp.department == "Customer Support" %}selected{% endif %}>Customer Support</option>
                                    <option value="Sales and Marketing" 
                                    {% if emp.department == "Sales and Marketing" %}selected{% endif %}>Sales and Marketing</option>
                                    <option value="Management" 
                                    {% if emp.department == "Management" %}selected{% endif %}>Management</option>
                                    <option value="Finance" 
                                    {% if emp.department == "Finance" %}selected{% endif %}>Finance</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="designation" class="form-label">Designation</label>
                                <select class="form-select" id="designation" name="designation" required>
                                    <option value="">Select Designation</option>
                                </select>
                            </div>

                            <script>
                                const designationsByDept = {
                                    "Human Resources": ["HR Executive", "HR Manager", "HR Assistant", "Recruitment Specialist", "Training Coordinator"],
                                    "Information Technology": ["Software Developer", "Backend Developer", "Frontend Developer", "Full Stack Developer", "DevOps Engineer", "QA Tester", "System Administrator", "IT Support Engineer"],
                                    "Sales and Marketing": ["Sales Executive", "Sales Manager", "Marketing Executive", "Digital Marketing Specialist", "SEO Specialist", "Business Development Executive"],
                                    "Finance": ["Accountant", "Senior Accountant", "Finance Manager", "Billing Executive", "Payroll Executive"],
                                    "Operations": ["Operations Executive", "Operations Manager", "Logistics Coordinator", "Supply Chain Manager"],
                                    "Customer Support": ["Customer Support Executive", "Call Center Agent", "Technical Support Executive", "Customer Relationship Manager"],
                                    "Administration": ["Admin Executive", "Office Manager", "Receptionist", "Clerk"],
                                    "Design and Creative": ["UI/UX Designer", "Graphic Designer", "Creative Director", "Product Designer"],
                                    "Management": ["Team Lead", "Project Manager", "Product Manager", "General Manager", "CEO", "COO", "CTO"],
                                    "Interns": ["HR Intern", "Developer Intern", "Marketing Intern", "Finance Intern", "Admin Intern"]
                                };

                                const deptSelect = document.getElementById("department");
                                const desigSelect = document.getElementById("designation");

                                function populateDesignations(selectedDept, selectedDesig = null) {
                                    desigSelect.innerHTML = '<option value="" disabled>Select Designation</option>';
                                    if (!selectedDept || !designationsByDept[selectedDept]) return;

                                    designationsByDept[selectedDept].forEach((desig) => {
                                        const opt = document.createElement("option");
                                        opt.value = desig;
                                        opt.textContent = desig;
                                        if (selectedDesig && desig === selectedDesig) opt.selected = true;
                                        desigSelect.appendChild(opt);
                                    });
                                }

                                // Listen for department change
                                deptSelect.addEventListener("change", (e) => {
                                    populateDesignations(e.target.value);
                                });

                                // ✅ Populate when editing existing employee
                                window.addEventListener("DOMContentLoaded", () => {
                                    const currentDept = "{{ emp.department }}";
                                    const currentDesig = "{{ emp.designation }}";
                                    if (currentDept) {
                                        deptSelect.value = currentDept;
                                        populateDesignations(currentDept, currentDesig);
                                    }
                                });
                            </script>

                            <!-- Joining Date -->
                            <div class="mb-3">
                                <label class="form-label">Joining Date</label>
                                <input type="text" class="form-control" id="joining_date" name="joining_date"
                                    value="{{ emp.joining_date|date:'Y-m-d' }}" disabled />
                            </div>

                            <!-- Action Buttons -->
                            <div class="text-center">
                                <button type="submit" name="action" value="update"
                                    class="btn btn-primary px-5">Update</button>
                                <button type="submit" name="action" value="delete" class="btn btn-danger px-5"
                                    onclick="return confirm('Are you sure you want to delete this employee?');">
                                    Delete
                                </button>
                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
